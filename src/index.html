<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Abyss Overlay</title>
    <script src="../src/index.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';"/>
</head>
<body>
    <div id="base">
        <div class="menu">
            <h1 class="menuitem" id="logo_title">ABYSS</h1>
            <!--add tooltips for buttons-->
            <img src="" id="clientimg">
            <button name="Discord Server" class="menuitem tabsbuttons" id="discord"></button>
            <button name="Information" class="menuitem tabsbuttons" id="info" style="width: 31px;"></button>
            <button name="Session" class="menuitem tabsbuttons" id="session" style="width: 31px;"></button>
            <button name="Music" class="menuitem tabsbuttons" id="music" style="width: 31px;"></button>
            <button name="Settings" class="menuitem tabsbuttons" id="settings"></button>
            <button name="Update" class="menuitem" id="update"></button>
            <button name="Quit" class="menuitem" id="quit"></button>
            <button name="Minimize" class="menuitem" id="minimize"></button>
            <button name="Show" class="menuitem" id="show"></button>
            <img id="musicvisualizer" src="../assets/musicvisualizer.gif">
            <!-- <button name="pp" class="menuitem" id="pp"></button> -->
            <!-- <button name="ppp" class="menuitem" id="ppp"></button> -->
        </div>

        <div id="settingsdiv">
            <div class="settings-container">
                <div class="setting-group" style="z-index: 2;">
                    <p>Stats Gamemode</p>
                    <div class="custom-select-wrapper" id="gamemodebtn" style="filter: none;">
                        <div class="custom-select">
                            <div class="custom-select_trigger"><span style="text-align: center; width: 85%;">Select</span>
                                <div class="arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" id="bw">Bedwars</span>
                                <span class="custom-option" id="sw">Skywars</span>
                                <span class="custom-option" id="duels">Duels</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="setting-group" style="z-index: 1;">
                    <p>Bedwars Stats Gamemode</p>
                    <div class="custom-select-wrapper" id="gmbtn" style="filter: none;">
                        <div class="custom-select">
                            <div class="custom-select_trigger"><span style="text-align: center; width: 85%;">Select</span>
                                <div class="arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" id="overall">Overall</span>
                                <span class="custom-option" id="solos">Solos</span>
                                <span class="custom-option" id="doubles">Doubles</span>
                                <span class="custom-option" id="threes">Threes</span>
                                <span class="custom-option" id="fours">Fours</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="setting-group">
                    <p>Minecraft IGN (username)</p>
                    <input type="text" class="api_key__input" id="ign_input" name="IGN" maxlength="16" size="20" spellcheck="false" placeholder="Type your IGN here" style="position: absolute; top: 4px; right: 3px;">
                    <span>You may choose to provide your Minecraft IGN (username) for access to extra features that require your IGN. Type it in and then click outside of the textbox.</span>
                </div>
                <div class="setting-group">
                    <p>Hypixel API Key</p>
                    <div style="position: absolute; top: 4px; right: 3px;">
                        <input type="text" class="api_key__input" id="api_key" name="Hypixel API Key" maxlength="36" size="36" spellcheck="false" placeholder="Click to paste API key">
                        <button name="Revert" class="revert" id="revert_api-key" style="display: inline-block; width: 28px; height: 28px;"></button>
                    </div>
                    <span>*OPTIONAL* This is your Hypixel API key. You may use it when the overlay backend API is down in order to still use the overlay. Hover over it to reveal and click to copy to clipboard.<br><b>NOTE:</b> Using your own Hypixel API key in the overlay puts you in Developer mode and is to be used at your own risk!</span>
                </div>
                <div class="setting-group">
                    <p>Hypixel API Key Fallback</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="fbkeybtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Your own Hypixel API key will be used as fallback to fetch player stats when you have been ratelimited by our backend.<br><b>NOTE:</b> Only applies when you have entered a valid Hypixel API key above.</span>
                </div>
                <div class="setting-group">
                    <p>Autowho [BETA]</p>
                    <label class="switch">
                        <input type="checkbox" id="whobtn">
                        <span class="slider round"></span>
                    </label>
                    <span>Overlay will automatically type /who in chat for you. After joining a lobby, wait a couple of seconds before touching your keyboard to avoid interfering with autowho. [AYOR]</span>
                </div>
                <div class="setting-group">
                    <p>Game Start Notifications</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="notifsbtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Receive a notification when the game starts. Feel free to tab out during the lobby without having to worry about when the game will start!</span>
                </div>
                <div class="setting-group">
                    <p>Auto Shrink/Unshrink</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="shrinkbtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Overlay will automatically switch between its shrinked and full display modes during key events so you don't miss out on any important stats changes while focusing on your game! It will shrink when your game begins and it will open back up when a player is added.</span>
                </div>
                <div class="setting-group">
                    <p>Guild Tags</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="gtagbtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Show guild tags next to player names. Makes 1 more Hypixel API call per player.<br><b>NOTE:</b> Only applies when your own Hypixel API key is being used.</span>
                </div>
                <div class="setting-group">
                    <p>External Players</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="callbtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Show the stats of players who type your name in chat; these players will show up with the CALL tag. Helpful for finding parties in lobbies. Also show players who send you party and friend requests.<br><b>NOTE:</b> You MUST enter your IGN in the settings for this feature to work!</span>
                </div>
                <div class="setting-group">
                    <p>Discord Rich Presence</p>
                    <label class="switch">
                        <input class="settingspage" type="checkbox" id="rpcbtn" checked>
                        <span class="slider round"></span>
                    </label>
                    <span>Show off your overlay and stats in your Discord status!</span>
                </div>
                <div class="setting-group" style="z-index: 2;">
                    <p>Discord RPC Stats</p>
                    <div class="custom-select-wrapper" id="rpcStats" style="width: 45%">
                        <div class="custom-select">
                            <div class="custom-select_trigger"><span style="text-align: center; width: 85%;">Select</span>
                                <div class="arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" id="rpcSession">会话统计数据</span>
                                <span class="custom-option" id="rpcOverall">总体统计数据</span>
                                <span class="custom-option" id="rpcNo">隐藏统计数据</span>
                            </div>                            
                        </div>
                    </div>
                    <span>Choose what stats to show off in your Discord status.</span>
                </div>
                <div class="setting-group">
                    <p>Change Client</p>
                    <div class="custom-select-wrapper" id="changeclient" style="width: 240px">
                        <div class="custom-select">
                            <div class="custom-select_trigger" style="text-align: center;">Select Client</div>
                        </div>
                    </div>
                    <span>Change your Minecraft client that the overlay detects.<br>WILL RESTART OVERLAY!</span>
                </div>
                <div class="setting-group">
                    <p>Custom Chat Log File</p>
                    <div class="custom-select-wrapper" id="changelogpath" style="width: 260px">
                        <div class="custom-select">
                            <div class="custom-select_trigger" style="text-align: center;">Select Log File</div>
                        </div>
                    </div>
                    <span>Change client's chat log file path. Select the correct latest.log file that your client writes its chat logs to.<br>WILL RESTART OVERLAY!</span>
                </div>
                <!--
                    To add a keybind, copy and paste one of the divs, changing the "data-type" and "data-default"
                    Then add a case to the main.js in the switch statement with the logic in setKeybind
                -->
                <div class="setting-group">
                    <p>Keybinds</p>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <p>Show/Hide Overlay:</p>
                        <div class="custom-select_trigger keybind" data-type="peak" data-default="CommandOrControl+Shift+A" style="text-align: center;">CTRL + SHIFT + A</div>
                        <button name="Revert" class="revert revertkeybind"></button>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <p>Clear Player List:</p>
                        <div class="custom-select_trigger keybind" data-type="clear" data-default="CommandOrControl+Shift+Z" style="text-align: center;">CTRL + SHIFT + Z</div>
                        <button name="Revert" class="revert revertkeybind"></button>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <p>Toggle Click-Through:</p>
                        <div class="custom-select_trigger keybind" data-type="through" data-default="CommandOrControl+Shift+T" style="text-align: center;">CTRL + SHIFT + T</div>
                        <button name="Revert" class="revert revertkeybind"></button>
                    </div>
                </div>
                <div class="setting-group">
                    <p>Overlay Theme</p>
                    <div style="position: absolute;top: 1px;right: 1px;width: 200px;display: flex;justify-content: space-between;">
                        <div style="overflow: visible; height: 35px; width: 30px; z-index: 1;">
                            <div id="color-picker"></div>
                        </div>
                        <button name="Revert" class="revert" id="revertcolor"></button>
                    </div>
                </div>
            </div>
        </div>

        <div id="infodiv">
            <p class="infopage" style="width: 100%; margin-left: 2px; text-align: left; color: var(--primaryColor)">➤统计数据颜色键：</p>
            <div class="infopage" style="background: #AAAAAA; color: #555555; width: 16%; margin-left: 5px;">BAD</div>
            <div class="infopage" style="background: #FFFFFF; color: #AAAAAA; width: 16%;">OK</div>
            <div class="infopage" style="background: #FFAA00; color: #FFFF55; width: 16%;">DECENT</div>
            <div class="infopage" style="background: #00AAAA; color: #55FFFF; width: 16%;">GOOD</div>
            <div class="infopage" style="background: #AA0000; color: #FF5555; width: 16%;">LEGEND</div>
            <div class="infopage" style="background: #AA00AA; color: #FF55FF; width: 16%;">GOD</div>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤标签：</p>
            <div class="infopage" style="color: #F3FF00; width: 16%; line-height: 23px; margin-left: 5px;">NICK - 更名的玩家</div>
            <div class="infopage" style="color: #FF5555; width: 16%; line-height: 23px;">SNPR - 潜在狙击手</div>
            <div class="infopage" style="color: #5555FF; width: 16%; line-height: 23px;">ALT - 潜在替代账号</div>
            <div class="infopage" style="color: #FFB900; width: 20%; line-height: 23px;">PRTY - 可能在一个派对中</div>
            <div class="infopage" style="color: #03C800; width: 20%; line-height: 23px;">P - 在您的派对中（仅限大厅）</div>
            <div class="infopage" style="color: #00C2A2; width: 16%; line-height: 23px;">CALL - 在大厅中输入了您的IGN</div>
            <div class="infopage" style="color: #37B836; width: 20%; line-height: 23px;">PREQ - 邀请您加入他们的派对</div>
            <div class="infopage" style="color: #D6D600; width: 20%; line-height: 23px;">FREQ - 向您发送好友请求</div>
            <div class="infopage" style="color: #36C700; width: 20%; line-height: 23px;">GLD - 来自您的公会列表的玩家</div>
            <div class="infopage" style="color: #D071DA; width: 20%; line-height: 23px;"><img src="https://i2.wp.com/erisly.com/assets/img/premium/boost.def36ba.png" width="25" height="25"> - Discord服务器的赞助者</div>
            <div class="infopage" style="color: #00FF00; width: 20%; line-height: 23px;"><span style="font-size: 26px">✔</span> - 已验证（加入Discord服务器）</div>
            <div class="infopage" style="color: red; width: 20%; line-height: 23px;"><span style="font-size: 26px">❤</span> - 捐赠者（加入Discord服务器）</div>
            <p class="infopage" style="width: 100%; text-align: left; margin-left: 2px; margin-top: 25px; color: var(--primaryColor)">➤隐藏/显示方式：CTRL+SHIFT+A</p>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤如何使用：</p>
            <p class="infopage" style="width: 100%; font-size: 15px; margin-left: 2px; text-align: left;">✧在游戏大厅中输入"/who"以获取在悬浮窗口注册的所有玩家（可能需要几秒钟）。✧建议：将悬浮窗口定位在屏幕的左上角或右上角，并让免手操作功能控制悬浮窗口的大小（详见下文）</p>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤特点：</p>
            <p class="infopage" style="width: 100%; font-size: 15px; margin-left: 2px; text-align: left;">✧通过拖动边缘调整大小。✧免手操作：游戏开始时自动缩小至仅显示标题栏，在大厅中有玩家变更时自动展开，您可以在右上角的绿色箭头上切换此模式</p>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤会话统计数据：</p>
            <p class="infopage" style="width: 100%; font-size: 15px; margin-left: 2px; text-align: left;">✧点击标题栏上的时钟按钮查看您的会话统计数据，以及自打开悬浮窗口以来的统计数据变化。✧执行"/api new"将重置您的会话统计数据</p>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤命令：</p>
            <p class="infopage" style="width: 100%; font-size: 15px; margin-left: 2px; text-align: left;">✧"/w cl"将清除悬浮窗口上的玩家。✧"/w ![IGN]"将显示您输入的玩家[IGN]的统计数据（例如："/w !OhChit"）</p>
            <p class="infopage" style="width: 100%; margin-left: 2px; margin-top: 20px; text-align: left; color: var(--primaryColor)">➤附言：</p>
            <p class="infopage" style="width: 100%; font-size: 15px; margin-left: 2px; text-align: left;">✧此悬浮窗口处于早期阶段，可能会出现错误。由Chit（OhChit）制作。这是我第一次制作应用程序，请不要期望太多。请加入Discord并向我发送任何错误或建议！</p>
        </div>        

        <div id="sessiondiv">
            <img id="sessionavatar" style="position: absolute; right: 10px; margin-top: 10px; filter: drop-shadow(2px 2px rgb(0, 0, 0));">
            <p id="sessiontitle" class="sessionpage" style="font-size: 20px; position: relative; width: 100%; color: var(--primaryColor);">Session Stats Unavailable</p>
            <p id="sessionign" class="sessionpage" style="font-size: 25px; margin-top: 40px; margin-left: 10px; text-align: left; display: block;">--</p>
            <p id="sessionhtml" class="sessionpage" style="margin-top: 20px; margin-left: 10px; text-align: left;"><span style="color: red">ERROR LOADING STATS<br>ENTER YOUR IGN IN SETTINGS</span></p>
            <p id="sessiontime" class="sessionpage" style="right: 10px; bottom: 5px; position: absolute; font-size: 12px; text-align: right;">--</p>
        </div>

        <div id="musicdiv" style="filter: drop-shadow(2px 2px rgb(0, 0, 0));">
            <p id="sessiontitle" class="rainbow" style="font-size: 22px; margin-top: 0; position: relative; text-align: center; width: 100%;">Overlay音乐派对</p>
            <p class="musicintro" style="text-align: center; font-size: 20px; color: rgb(174, 50, 205);"><b>与您的派对一起欣赏音乐！他们都可以播放歌曲并一起控制音乐氛围</b></p>
            <p class="musicintro" style="text-align: left; font-size: 17px; margin: 5px; color: #1d6cff;"><span style="font-size: 19; text-decoration: underline;"><b>派对聊天使用命令：</b></span><br>• !play [歌曲名称] - 排队播放歌曲<br>• !remove [#] - 从队列中移除第#首歌曲<br>• !skip - 跳过当前歌曲<br>• !loop - 循环播放队列<br>• !clear - 清空整个队列</p>
            <p class="musicintro" id="unlinked" style="text-align: left; font-size: 20px; margin: 5px; color: red; text-decoration: underline; display: none;"><b>错误：您的MC账号未与Discord服务器中的机器人链接。点击顶部的Discord按钮加入服务器并在#bot-commands频道中使用".link [IGN]"命令，然后重试</b></p>
            <p class="musicintro" id="nomusicbots" style="text-align: left; font-size: 20px; margin: 5px; color: red; text-decoration: underline; display: none;"><b>错误：没有可用的音乐机器人。所有音乐机器人当前都在使用中。请稍后再试</b></p>
            <div class="musicintro" style="text-align: center; margin-top: 15px; margin-bottom: 15px;"><button class="musicintro" id="startmusic">开始音乐派对</button></div>
            <p class="musicintro" style="text-align: left; font-size: 18px; margin: 5px; color: rgb(187, 9, 9);"><span style="text-decoration: underline;"><b>注意：</b></span>您的MC账号必须先与Abyss Overlay Discord服务器中的机器人链接！您的私人语音频道将在该服务器中创建；您可以加入该频道并将您的派对成员拖入其中。</p>            
            <div class="musicplaying" style="width: 100%">
                <button name="EndMusic" class="musicplaying" id="endmusic">End Session</button>
                <p class="musicplaying" style="color: rgb(112, 112, 112); height: 14px; font-size: 14px; line-height: 14px; margin: 0 0 1px 10%;">NOW PLAYING</p>
                <p class="musicplaying" id="songname" style="color: var(--primaryColor); height: 22px; width: 80%; font-size: 19px; line-height: 19px; margin: 0 0 1px 10%; white-space: nowrap; overflow: hidden;">//</p>
                <div class="musicplaying" style="width: 90%; height: 10px; margin: 0 auto; overflow: visible; font-size: 0; margin-bottom: 5px;">
                    <p id="currentsongtime" class="songtimer" style="text-align: right; direction: rtl;">0:00</p>
                    <div style="display: inline-block; width: 89%; height: 10px; background-color: rgb(134, 134, 134); margin: 0 0.5% 0 0.5%; border-radius: 10px; overflow: hidden;"><div id="musicprogress"></div></div>
                    <p id="fullsongtime" class="songtimer" style="text-align: left; direction: ltr;">0:00</p>
                </div>
                <button name="Loop" class="musicbutton musicplaying" id="loopmusic" style="background-image: url(../assets/m_loop.png); margin-left: 40%;"></button>
                <button name="Play" class="musicbutton musicplaying" id="playmusic" style="background-image: url(../assets/m_play.png);"></button>
                <button name="Next" class="musicbutton musicplaying" id="skipmusic" style="background-image: url(../assets/m_skip.png);"></button>
    
                <div class="musicplaying" style="height: 280px; width: 60%; border: solid rgba(136, 136, 136, 0.74); border-width: 1px; border-radius: 10px; background-color: rgba(2, 2, 2, 0.199); margin: auto; margin-bottom: 5px; overflow: hidden;">
                    <p style="height: 10%; width: 100%; margin: 0; text-align: center; letter-spacing: 1px; background-color: rgba(145, 145, 145, 0.26); filter: drop-shadow(0);">QUEUE<span id="queuenum" style="height: 100%; width: 0%; overflow: visible; float: right; text-align: right; right: 2px; direction: rtl; font-size: 15px; vertical-align: middle; color: rgb(131, 131, 131);">0</span></p>
                    <div style="height: 100%; overflow-x: hidden; overflow-y: auto;">
                        <ul id="queuediv" style="width: 100%; margin: 0; padding: 0; list-style-type: none; font-family: Minecraftia; font-size: 0;">
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <p class="startup" style="color: var(--primaryColor)">选择您的客户端：</p>
        <button class="clientbutton" id="badlion" style="margin-left: 2.5%;">Badlion</button>
        <button class="clientbutton" id="lunar">Lunar 1.8.9</button>
        <button class="clientbutton" id="vanilla">Vanilla/其他</button>
        <button class="clientbutton" id="pvplounge" style="margin-left: 2.5%;">PvP Lounge</button>
        <button class="clientbutton" id="labymod">Laby Mod</button>
        <button class="clientbutton" id="feather">Feather</button>

        <!-- <p class="clientbutton updatenotif" style="color: red; display: none; width: 100%; word-wrap: break-word; white-space: normal; text-align: center;">THIS VERSION IS OUT OF DATE. UPDATE BY JOINING THE DISCORD OR CLICKING THE RED UPDATE BUTTON</p> -->
        <!--<iframe src="https://discord.com/widget?id=822639649247592528&theme=dark" width="350" height="340" allowtransparency="true" frameborder="0" sandbox="allow-same-origin allow-scripts"></iframe>-->
        <div id="titles">
            <p class="titleitems" style="width: 46.75%; padding-left: 2px;" id="playertitle">PLAYERS</p>
            <p class="titleitems" style="width: 6%;">TAG</p>
            <p class="titleitems" id="ws_nwl" style="width: 6.5%;">WS</p>
            <p class="titleitems" id="kdr" style="width: 9.5%;">FKDR</p>
            <p class="titleitems" style="width: 7%;">WLR</p>
            <!--<p class="titleitems" style="width: 7.25%;">BBLR</p>-->
            <p class="titleitems" id="kills" style="width: 11.25%;">FINALS</p>
            <p class="titleitems" style="width: 9%;/*background-color: rgba(238, 130, 238, 0.644);*/">WINS</p>
        </div>
        <div id="indexdiv">
            <ul class="indexes" id="ign" style="width: 46.75%; text-align: left; padding-left: 2px; list-style-type: none;"></ul>
            <ul class="indexes" id="tag" style="width: 6%; overflow: visible;"></ul>
            <ul class="indexes" id="ws" style="width: 6.5%;"></ul>
            <ul class="indexes" id="fkdr" style="width: 9.5%;"></ul>
            <ul class="indexes" id="wlr" style="width: 7%;"></ul>
            <!--<ul class="indexes" id="bblr" style="width: 7.25%;"></ul>-->
            <ul class="indexes" id="finals" style="width: 11.25%;"></ul>
            <ul class="indexes" id="wins" style="width: 9%;"></ul>
        </div>

        <div id="changelog">
            <p id="changelogVersion" style="width: 100%; height: 37px; margin: 0; padding: 0; background-color: rgb(75, 75, 75); text-align: center; font-size: 20px; color: var(--primaryColor);">Changelog</p>
            <p id="changelogClose">×</p>
            <p style="height: calc(100% - 37px); margin: 0; margin-left: 5px; padding: 0; overflow-y: auto; color: rgb(179, 179, 179);">
                - <b>Added UUID caching.</b> UUIDs are now cached to avoid making unnecessary calls to Mojang API<br><br>
                - <b>Reverted hotfix for Mojang API.</b> Mojang API is fixed now!
            </p>
        </div>
    </div>
</body>
</html>